# ゲーム機本体 機能リファレンス

このドキュメントは、ゲームソフト開発者が **GameCenter ゲーム機本体** の機能を活用するためのリファレンスです。
ここに記載されている機能は現在利用可能です。実装済みの機能を重複して開発依頼しないよう、ご一読ください。

## 1. ルーム管理

プレイヤーが集まる「ルーム」の管理は、すべてゲーム機本体が自動的に行います。

- **ルームの作成と参加:**
    - プレイヤーは、クライアント（フロントエンド）から `create_room` または `join_room` メッセージを送信することで、ルームを作成・参加します。
    - ゲームソフト側でこの処理を意識する必要はありません。
- **プレイヤー状態の同期:**
    - プレイヤーがルームに参加したり、退出（切断）したりすると、ゲーム機本体は自動的にルーム内の全プレイヤーに `room_update` メッセージを送信します。
    - ゲームソフトは、この通知を直接受け取ることはありませんが、ゲーム開始 (`/game/init`) 時のプレイヤーリストは常に最新の状態に保たれます。

## 2. ゲーム進行フロー

ゲームの開始から終了までの大まかな流れは、ゲーム機本体の機能を使って制御します。

- **① ゲーム選択:**
    - ルームのホストがクライアント上でプレイしたいゲームを選択すると、`select_game` メッセージが送信されます。
    - ゲーム機本体はルームの `selected_game` 情報を更新し、`room_update` で全員に通知します。
- **② ゲーム開始:**
    - ホストが「ゲーム開始」ボタンを押すと、`start_game` メッセージが送信されます。
    - ゲーム機本体は、選択されているゲームソフトの `POST /game/init` APIを呼び出します。
    - これが、ゲームソフトにとっての「開始シグナル」となります。
- **③ フェーズ進行:**
    - ゲームソフトは、自身のロジックに基づき、好きなタイミングでゲームのフェーズを進行させることができます。
    - `POST /game/next_phase` APIを呼び出すと、ゲーム機本体は指定されたフェーズ情報を `game_state` メッセージとして全プレイヤーにブロードキャストします。

## 3. リアルタイム判定機能

ゲーム機本体が提供する高精度なリアルタイム判定機能です。

### 早押し (First Press)

- **機能:** 複数のプレイヤーの中で、誰が最も早くアクションを起こしたかをマイクロ秒単位で判定します。
- **使い方:**
    1.  **受付開始:** ゲームソフトが、ゲーム機本体の `POST /realtime/enable_action` APIを呼び出します。`action_type` に `first_press`、`enabled` に `true` を指定します。
    2.  **プレイヤーのアクション:** プレイヤーがクライアントのボタンを押すと、`realtime_action` (type: `first_press`) メッセージがゲーム機本体に送信されます。
    3.  **結果通知:** ゲーム機本体は、最初の1名のアクションのみを受け付け、勝者を決定します。その後、ゲームソフトの `POST /game/event` APIを呼び出し、勝者の `player_id` を通知します。
    4.  **受付終了:** ゲームソフトは、再度 `POST /realtime/enable_action` を `enabled: false` で呼び出し、以降の早押し入力を無効化する必要があります。

## 4. ブロードキャスト機能

ルーム内の全プレイヤーに、任意の情報を同時に通知したい場合に使用します。

- **機能:** ゲームソフトからのリクエストに基づき、ゲーム機本体が指定されたデータを全プレイヤーに一斉配信します。
- **使い方:**
    - ゲームソフトが、ゲーム機本体の `POST /realtime/broadcast` APIを呼び出します。
    - `event_type` と `data` を自由に設定できます。
    - ゲーム機本体は、これを受け取ると `broadcast_event` メッセージとして全プレイヤーに中継します。
- **主な用途:**
    - クイズの問題文や選択肢の表示
    - 全員へのアナウンス
    - ラウンド開始や終了の合図

---

## 補足: 未実装の機能

以下の機能は、将来的な拡張項目として検討されていますが、**現在のバージョンでは利用できません。**

-   タイマー制御 (`start_timer`, `timer_expired`)
-   ターン制管理 (`turn_action`)
-   ゲームソフト側からの動的なUI更新 (`update_ui`)
-   ゲームの自動検出
-   ルーム設定の変更

これらの機能が必要な場合は、「ゲーム開発者向けガイドライン」のテンプレートに従って機能拡張要求を提出してください。
